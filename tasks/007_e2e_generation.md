# Isometric NYC E2E Generation

OK we have all the pieces needed to generate a massive isometric pixel art map
of NYC! We've fine-tuned a model that can generate pixel art from a 3D rendered
tile, as well as "infill" from a template that has one or more quadrants from a
neighboring tile.

The first step we'll need to decide on is a database of tiles - the file system
has worked pretty well for testing everything out, but we'll want to do a bit
better in terms of managing tiles and their "quadrants". Here's a rough sketch
of what we'll need to do:

A generation is defined with the following config:

```generation_config.json
{
  "name": The name of the generation,
  "seed": {
    "lat": The latitude of the "seed" of generation,
    "lng": The longitude of the "seed" of generation,
  }
  "bounds": {
    "top_left": {
      "lat": float,
      "lng: float
    },
    "bottom_left": {
      "lat": float,
      "lng": float,
    },
    "top_right": {
      "lat": float,
      "lng: float
    },
    "bottom_right": {
      "lat": float,
      "lng": float,
    }
  },
  "camera_azimuth_degrees": -15,
  "camera_elevation_degrees": -45,
  "width_px": 1024,
  "height_px": 1024,
  "view_height_meters": The view height of the generation
}
```

This generation config will be stored in a subdirectory of the root
`generations` dir (e.g. `generations/<name>`)

From this generation config, we'll construct a grid of tiles. Each tile is an
isometric view centered on a centroid and with the camera azimuth, height, and
elevation. Starting from the seed, we'll expand tiles outward in every direction
until they reach the

This process should follow the logic of `src/isometric_nyc/plan_tiles.py`, with
the following changes:

Rather than storing tiles, we'll be storing "quadrants" - each tile is divided
into a 4x4 grid of quadrants. Each quadrant will have an "anchor" lat/lng
corresponding to its bottom right corner. In this way, the top left quadrant of
a tile will have the same lat/lng "anchor" as the "centroid" of the tile.

We'll want to save all of these quadrants in a SQLite db, stored in the
generations dir. Let's do something like the following schema:

Table: Quadrants

| Column      | Type   | Description                                                                 |
| ----------- | ------ | --------------------------------------------------------------------------- |
| Id          | String | A unique hash id for the quadrant                                           |
| Lat         | Float  | The lat of the bottom right "anchor"                                        |
| Lng         | Float  | The lng of the bottom right "anchor"                                        |
| Render      | Bytes  | The 3d render of the quadrant, stored as the bytes of a png image           |
| Generation  | Bytes  | The generated pixel art of the quadrant, stored as the bytes of a png image |
| IsGenerated | Bool   | A computed column indicating whether there's generated bytes                |
| Notes       | String | Any optional notes for the quadrant                                         |

The SQLite DB should be populated with ALL quadrants, but the `Render` and
`Generation` columns should of course be empty.

Let's first create a new directory `src/isometric_nyc/generation` and create
a new python script called `seed_tiles` (that follows the arg/param conventions
of scripts such as `export_views.py`) that will take a single arg
`generation_dir` that points at an empty directory containing a
"generation_config.json" and populates the SQLite DB in the directory

# Step 2:

Let's update the schema slightly - every quadrant should now also have x and y
indices, which indicate how many quadrants left/right/up/down they are from the
seed quadrant (upper right corner of the seed tile). Up should be negative
steps, and right should be positive.
